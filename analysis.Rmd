---
title: "Top 50 Analysis"
date: "`r paste0('Last Updated: ', format(Sys.time(), '%d %B, %Y')) `"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r setup, include = F}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
knitr::opts_chunk$set(fig.align = 'center')

library(tidyverse)
library(patchwork)
# library(pdwtheme)
library(gt)
library(infer)
# To Turn off Scientific Notation Use this.
options(scipen = 999)

source("./src/spacee_theme.R")

theme_set(theme_bw())
```


# Executive Summary {.tabset .tabset-pills}

<div class = "summaryblock">

## Prompt

__Prompt:__

Perform the following with the attached “top50.csv” file:   

* Load the dataset and perform EDA and determine if any cleanup (data conversions, name changes, scaling, imputation of missing values, etc.) is needed.  
* Determine if any correlation exists between features.  
* Visualize and examine the distribution of popularity scores and show if any outliers or skewing exists.  
* Perform any transformations as needed and create a model to predict the popularity of a song, while avoiding overfitting and showing relevant scores.

## Goal  

__Goal:__  

We want to know the impact the Loop™ campaign had on sales. By comparing the different groups we would like to learn a few different things:  

* Is there an impact of the "Brewery A" Loop™ Campaign on sales?
    * If we see that the "program_test" condition has increased sales as compared to both the baseline and the "film_control" condition we can be confident that it was Brewery A's film that had the affect on sales and not just the slick Loop™ campaign ipad with the other videos.
* If so what is the impact? (Sales amount vs sales dollars)

 

 
## Results

__Results:__  
From the analysis we find that:

1. Overall the Loop™ campaign looks to had a positive impact on Brewery A's sales.  
1. The sales increased year over year for all groups.  
    * This could mean that the brand awareness for the Brewery has generally increased over time.
    * Could be a Covid affect (more people trying beer) or that there were more options made available to customers over time.
1. The "program test" both show an increase in the mean sales (both amount and dollars) as compared to the baseline and the film control.  
    * For this sample, it looks like the Loop™ campaign __increased Brewery A sales on average by ~$15__ (roughly 1 additional unit) on average as compared to the baseline  


__Potential Investigation Next Steps:__ 

* It would be interesting in future iterations, 

## Assumptions 

__Assumptions:__
_(Note: this section would likely take a different shape as familiarity with the data source increase/ relationship with the customer develops)_ 

With this analysis we are assuming that: 



</div>



# Overview of Data {.tabset .tabset-pills}
Load the dataset and perform EDA and determine if any cleanup (data conversions, name changes, scaling, imputation of missing values, etc.) is needed. 

## Load Data
 
```{r}
top50 <- read_csv(here::here("inputs", "top50.csv")) %>% 
  select(-...1) %>% 
  mutate(CleanTrack = iconv(Track.Name, to = "utf-8"))

names(top50) <- gsub("\\.", "", names(top50)) # ro remove periods from column names

```


## Review ggpairs for variables
Looks like upon initial review that there are decent correlations between:  

* BPM and Speechiness  
* Energy and Loudness  
* Energy and Valence  
* Energy and Acousticness  
* Popularity and Valence  

I am not sure what "Valence" means, so I would probably want to look this up to understand it a little more.


```{r, fig.widt=12, fig.height=12}
GGally::ggpairs(top50, columns = 4:13)
```

## Review Genre

Looked to see if there are general groups the different genres fall within.   

* There are many pop songs as well as multiple pop categories. It's possible that the category of a song could impact it's popularity, but that analysis is likely one for a larger dataset.


```{r}

top50 %>% 
  mutate(GenreGroup = case_when(str_detect(Genre, "pop") ~ "pop",
                                str_detect(Genre, "hip hop") ~ "hip hop",
                                str_detect(Genre, "rap") ~ "rap",
                                str_detect(Genre, "reggaeton") ~ "reggaeton",
                                TRUE ~ "Other")) %>% 
  count(GenreGroup,Genre, sort=T) %>% 
  arrange(GenreGroup, n) %>% 
  DT::datatable()

```



# Colinearity Review
Determine if any correlation exists between features.  

# Popularity Scores
Visualize and examine the distribution of popularity scores and show if any outliers or skewing exists.  

Decided to overlay a violin and a box plot.   

* It looks like the popularity scores range from 70 to 95, with the majority of the scores falling more within the 85 to 92 range.  
* Accordingly the two lowest scores of 70 and 78 fall out of the lower quartile, and could be considered outliers in this dataset. 


```{r}
top50 %>% 
  ggplot(aes(x= "", y= Popularity))+
  geom_violin(alpha = 0.2, fill = "grey")+
  geom_boxplot(alpha = 0.6)+
  labs(title = "Distribution of Popularity")
```


# Predict Popularity
Perform any transformations as needed and create a model to predict the popularity of a song, while avoiding overfitting and showing relevant scores.

```{r}

```









